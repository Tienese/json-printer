<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${report.quizTitle} + ' - Print Report'">Quiz Print Report</title>
    
    <style>
        /* ===== PRINT-OPTIMIZED STYLES ===== */
        
        /* Global Reset for Print */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Times New Roman', Times, serif;
            font-size: 11pt;
            line-height: 1.3;
            color: #000;
            background: #fff;
        }
        
        /* A4 Page Setup with 1.72cm margins */
        @page {
            size: A4;
            margin: 1.72cm;
        }
        
        @media print {
            body {
                margin: 0;
                padding: 0;
            }
            
            /* Hide screen-only elements */
            .no-print {
                display: none !important;
            }
            
            /* Page break controls */
            .student-report {
                page-break-after: always;
                page-break-inside: avoid;
            }
            
            .student-report:last-child {
                page-break-after: auto;
            }
            
            .question-block {
                page-break-inside: avoid;
            }
            
            /* Prevent orphans/widows */
            h1, h2, h3, h4, h5, h6 {
                page-break-after: avoid;
            }
            
            p {
                orphans: 3;
                widows: 3;
            }
        }
        
        /* ===== SCREEN STYLES ===== */
        .no-print {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: #333;
            color: #fff;
            padding: 15px;
            text-align: center;
            z-index: 1000;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .no-print button {
            background: #fff;
            color: #333;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            border-radius: 4px;
            margin: 0 10px;
        }
        
        .no-print button:hover {
            background: #f0f0f0;
        }
        
        .print-container {
            max-width: 21cm; /* A4 width */
            margin: 80px auto 40px auto;
            padding: 1.72cm;
            background: #fff;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        
        @media print {
            .print-container {
                margin: 0;
                padding: 0;
                box-shadow: none;
                max-width: none;
            }
        }
        
        /* ===== REPORT STRUCTURE ===== */
        
        /* Student Report Container */
        .student-report {
            margin-bottom: 2cm;
        }
        
        /* Student Header */
        .student-header {
            border-bottom: 2px solid #000;
            padding-bottom: 8px;
            margin-bottom: 16px;
        }
        
        .student-header h1 {
            font-size: 18pt;
            font-weight: bold;
            margin-bottom: 4px;
        }
        
        .student-info {
            font-size: 10pt;
            color: #333;
        }
        
        /* Question Block */
        .question-block {
            margin-bottom: 18px;
            border: 1px solid #000;
            padding: 10px;
        }
        
        .question-header {
            background: #f0f0f0;
            padding: 6px 8px;
            margin: -10px -10px 10px -10px;
            border-bottom: 1px solid #000;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .question-number {
            font-weight: bold;
            font-size: 11pt;
        }
        
        .question-points {
            font-size: 9pt;
            color: #555;
        }
        
        .question-text {
            margin-bottom: 10px;
            font-size: 11pt;
        }
        
        /* Answer Section */
        .answer-section {
            margin-top: 10px;
            padding: 8px;
            background: #fafafa;
            border-left: 3px solid #ddd;
        }
        
        .answer-row {
            margin-bottom: 6px;
        }
        
        .answer-label {
            font-weight: bold;
            font-size: 10pt;
            display: inline-block;
            min-width: 120px;
        }
        
        .answer-value {
            font-size: 10pt;
        }
        
        /* Correctness Indicators */
        .correct-indicator {
            display: inline-block;
            padding: 2px 8px;
            font-size: 9pt;
            font-weight: bold;
            border-radius: 3px;
        }
        
        .correct-indicator.correct {
            background: #e8f5e9;
            color: #2e7d32;
            border: 1px solid #4caf50;
        }
        
        .correct-indicator.incorrect {
            background: #ffebee;
            color: #c62828;
            border: 1px solid #f44336;
        }
        
        @media print {
            .correct-indicator.correct {
                background: #fff;
                border: 2px solid #000;
            }
            
            .correct-indicator.incorrect {
                background: #ddd;
                border: 2px solid #000;
            }
        }
        
        /* Feedback Section */
        .feedback-section {
            margin-top: 10px;
            padding: 8px;
            border-top: 1px solid #ccc;
            font-size: 10pt;
        }
        
        .feedback-section .feedback-label {
            font-weight: bold;
            margin-bottom: 4px;
        }
        
        .feedback-general,
        .feedback-correct,
        .feedback-incorrect,
        .feedback-answer-specific {
            margin-bottom: 6px;
            padding-left: 12px;
            border-left: 2px solid #999;
        }
        
        /* Utility Classes */
        .text-muted {
            color: #666;
        }
        
        .mb-1 { margin-bottom: 4px; }
        .mb-2 { margin-bottom: 8px; }
        .mt-1 { margin-top: 4px; }
        .mt-2 { margin-top: 8px; }
        
        /* List Styling */
        ul, ol {
            margin-left: 20px;
            margin-bottom: 8px;
        }
        
        li {
            margin-bottom: 4px;
        }
    </style>
</head>
<body>

<!-- Screen-only Controls -->
<div class="no-print">
    <button onclick="window.print()">üñ®Ô∏è Print Report</button>
    <button onclick="window.history.back()">‚Üê Back</button>
</div>

<!-- Print Container -->
<div class="print-container">
    
    <!-- Loop through each student -->
    <div th:each="studentReport, iterStat : ${report.studentReports}" class="student-report">
        
        <!-- Student Header -->
        <div class="student-header">
            <h1 th:text="${studentReport.student.fullName}">Student Name</h1>
            <div class="student-info">
                <span><strong>Student ID:</strong> <span th:text="${studentReport.student.studentId}">12345</span></span>
                <span style="margin-left: 20px;"><strong>Quiz:</strong> <span th:text="${report.quizTitle}">Quiz Title</span></span>
            </div>
        </div>
        
        <!-- Questions -->
        <div th:each="result, qIterStat : ${studentReport.questionResults}" class="question-block">
            
            <!-- Question Header -->
            <div class="question-header">
                <span class="question-number">
                    Question <span th:text="${qIterStat.index + 1}">1</span>: 
                    <span th:text="${result.question.questionName}">Question Title</span>
                </span>
                <span class="question-points">
                    <span th:text="${result.question.pointsPossible}">1.0</span> pts
                </span>
            </div>
            
            <!-- Question Text -->
            <div class="question-text" th:utext="${result.question.questionText}">
                Question text goes here
            </div>
            
            <!-- Answer Section -->
            <div class="answer-section">
                <div class="answer-row">
                    <span class="answer-label">Student Answer:</span>
                    <span class="answer-value" th:text="${result.studentAnswer}">A</span>
                    <span class="correct-indicator" 
                          th:classappend="${result.correct} ? 'correct' : 'incorrect'"
                          th:text="${result.correct} ? '‚úì Correct' : '‚úó Incorrect'">
                        Status
                    </span>
                </div>
                
                <div class="answer-row" th:if="${!result.correct && !result.correctAnswers.isEmpty()}">
                    <span class="answer-label">Correct Answer<span th:if="${result.correctAnswers.size() > 1}">s</span>:</span>
                    <span class="answer-value">
                        <span th:each="correct, cIterStat : ${result.correctAnswers}">
                            <span th:text="${correct}">Correct Answer</span><span th:if="${!cIterStat.last}">, </span>
                        </span>
                    </span>
                </div>
            </div>
            
            <!-- Feedback Section -->
            <div class="feedback-section" th:if="${result.feedbackToShow != null && !result.feedbackToShow.isEmpty()}">
                <div class="feedback-label">Feedback:</div>
                <div th:utext="${result.feedbackToShow}">
                    Feedback content here
                </div>
            </div>
            
        </div>
        
    </div>
    
</div>

<script>
    // Auto-print on load (optional)
    // window.addEventListener('load', function() {
    //     setTimeout(function() { window.print(); }, 500);
    // });
</script>

</body>
</html>
