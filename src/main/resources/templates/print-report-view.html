<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ja">
<head>
    <meta charset="UTF-8">
    <title th:text="${quizzes[0].quizTitle} + ' - Print Report'">Quiz Print Report</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Noto+Sans:wght@400;500;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" th:href="@{/css/theme/variables.css}">
    <link rel="stylesheet" th:href="@{/css/theme/reset.css}">
    <link rel="stylesheet" th:href="@{/css/layout/screen.css}">
    <link rel="stylesheet" th:href="@{/css/layout/print.css}" media="print">
    
    <style>
        .q-meta { font-weight: 700; margin-right: 5px; white-space: nowrap; }
        .status-correct { color: var(--color-ink-primary); }
        .status-incorrect { color: var(--color-ink-primary); }
        
        .box {
            display: inline-block;
            width: 12px; height: 12px;
            border: 1px solid var(--color-ink-primary);
            margin-right: 4px; vertical-align: middle;
        }
        .box.picked { background-color: var(--color-ink-primary); }
        
        .picked-wrong .opt-text { text-decoration: line-through; }
        .is-correct-option .opt-text::after { content: ' ‚úì'; font-weight: bold; }
        
        /* Edit Mode Overrides */
        .edit-mode .editable-field {
            border-bottom: 1px dashed #007bff;
            background-color: rgba(0, 123, 255, 0.05);
        }
        
        /* Review Section */
        .review-header {
            font-size: 12pt; font-weight: 900; text-transform: uppercase;
            border-bottom: 2px solid var(--color-ink-primary);
            margin: 20px 0 15px 0;
        }
    </style>
</head>
<body>

    <div class="static-toolbar no-print">
        <div class="toolbar-group">
            <a href="/dashboard" class="btn-toolbar" aria-label="Back">
                <span>&larr; Dashboard</span>
            </a>
        </div>
        <div class="toolbar-group">
            <button id="editToggle" onclick="toggleEditMode()" class="btn-toolbar">
                <span>‚úé Edit Mode</span>
            </button>
            <button id="saveEdits" onclick="saveEdits()" class="btn-toolbar btn-primary" style="display: none;">
                <span>üíæ Save Changes</span>
            </button>
            <button onclick="window.print()" class="btn-toolbar btn-primary">
                <span>üñ®Ô∏è Print</span>
            </button>
        </div>
    </div>

    <div class="paper-sheet">
        
        <div th:each="quiz : ${quizzes}">
            <div th:each="student, iter : ${quiz.students}" class="student-wrapper"
                 th:classappend="${!iter.first} ? 'page-break' : ''">

                <div class="student-header" style="border-bottom: 2px solid #000; margin-bottom: 15px; padding-bottom: 5px; display: flex; justify-content: space-between; font-weight: bold;">
                    <span class="editable-field" data-field="studentName" th:text="${student.studentName}">Name</span>
                    <span class="editable-field" data-field="studentId" th:text="${student.studentId}">ID</span>
                    <span th:text="${quiz.quizId}">Quiz ID</span>
                </div>

                <div th:each="question, qStat : ${student.questions}" class="question-wrapper">
                    <div style="margin-bottom: 12px; break-inside: avoid;">
                        <span class="q-meta">
                            <span th:if="${question.answerStatus.name() == 'CORRECT'}" aria-label="Correct">‚úì</span>
                            <span th:if="${question.answerStatus.name() == 'INCORRECT'}" aria-label="Incorrect">‚úó</span>
                            <span th:if="${question.answerStatus.name() == 'UNANSWERED'}" aria-label="Unanswered">‚ñ≤</span>
                            <span th:text="${question.questionNumber} + '.'">1.</span>
                        </span>
                        
                        <span class="editable-field" data-field="questionText" th:utext="${question.questionText}">Question</span>

                        <div th:if="${question.hasOptions}" style="margin-left: 15px; margin-top: 4px;">
                            <div th:each="option : ${question.options}" style="display: inline-block; width: 48%; vertical-align: top;">
                                <span class="box" th:classappend="${option.studentAnswer} ? 'picked' : ''"></span>
                                <span th:text="${option.optionLetter} + '.'">A.</span>
                                
                                <span class="opt-text editable-field" 
                                      data-field="optionText" 
                                      th:text="${option.optionText}"
                                      th:classappend="${(option.studentAnswer and !option.correct ? 'picked-wrong ' : '') + (option.correct ? 'is-correct-option' : '')}"
                                      th:aria-label="${option.correct ? 'Correct Option' : 'Option'}">
                                      Option Text
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div th:if="${!student.incorrectQuestionNumbers.isEmpty()}">
                    <div class="review-header">Review Required</div>
                    </div>
            </div>
        </div>
    </div>

    <script th:src="@{/js/print-report-editor.js}"></script>
</body>
</html>